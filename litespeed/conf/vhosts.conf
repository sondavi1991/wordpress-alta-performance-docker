#
# Configuração Virtual Host para WordPress
# Otimizada para performance e compatibilidade
#

docRoot                   /var/www/html
vhDomain                  *
vhAliases                 
adminEmails               webmaster@localhost
enableGzip                1
enableIpGeo               1

# Index files
index  {
  useServer               0
  indexFiles              index.php, index.html
  autoIndex               0
  autoIndexURI            /_autoindex/default.php
}

# Logs específicos do virtual host
errorlog /usr/local/lsws/logs/vhosts/wordpress/error.log {
  useServer               0
  logLevel                ERROR
  rollingSize             10M
}

accesslog /usr/local/lsws/logs/vhosts/wordpress/access.log {
  useServer               0
  rollingSize             10M
  keepDays                30
  logFormat               "%h %l %u %t \"%r\" %>s %b"
}

# Configurações de script handler
scripthandler  {
  add                     lsphp82 php
}

# Regras de rewrite para WordPress
rewrite  {
  enable                  1
  autoLoadHtaccess        1
  
  # WordPress pretty permalinks
  rules                   <<<END_rules
  RewriteEngine On
  RewriteBase /
  RewriteRule ^index\.php$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.php [L]
END_rules
}

# Contextos para otimização
context /wp-content/ {
  type                    NULL
  location                /var/www/html/wp-content/
  allowBrowse             1
  
  # Cache estático
  rewrite  {
    enable                1
    rules                 <<<END_rules
    <IfModule mod_expires.c>
      ExpiresActive On
      ExpiresByType image/jpg "access plus 1 month"
      ExpiresByType image/jpeg "access plus 1 month"
      ExpiresByType image/gif "access plus 1 month"
      ExpiresByType image/png "access plus 1 month"
      ExpiresByType text/css "access plus 1 month"
      ExpiresByType application/pdf "access plus 1 month"
      ExpiresByType text/javascript "access plus 1 month"
      ExpiresByType application/javascript "access plus 1 month"
      ExpiresByType application/x-javascript "access plus 1 month"
      ExpiresByType application/x-shockwave-flash "access plus 1 month"
      ExpiresByType image/x-icon "access plus 1 year"
      ExpiresDefault "access plus 2 days"
    </IfModule>
END_rules
  }
}

# Contexto para uploads
context /wp-content/uploads/ {
  type                    NULL
  location                /var/www/html/wp-content/uploads/
  allowBrowse             1
  enableExpires           1
  expiresByType           image/* A604800
  expiresByType           text/css A2592000
  expiresByType           application/x-javascript A2592000
  expiresByType           application/javascript A2592000
  expiresByType           text/javascript A2592000
}

# Context para wp-admin
context /wp-admin/ {
  type                    PHP
  location                /var/www/html/wp-admin/
  allowBrowse             1
  indexFiles              index.php
  
  # Restrições de acesso
  accessControl  {
    allow                 *
  }
}

# Context para wp-includes
context /wp-includes/ {
  type                    NULL
  location                /var/www/html/wp-includes/
  allowBrowse             0
  
  # Bloquear acesso direto a arquivos PHP
  rewrite  {
    enable                1
    rules                 <<<END_rules
    <Files "*.php">
      Order Allow,Deny
      Deny from all
    </Files>
END_rules
  }
}

# Configurações de segurança
security  {
  # Proteção contra hotlinking
  hotlinkCtrl             1
  suffixes                gif,jpeg,jpg,png,bmp
  redirectUri             
  onlySelf                1
  
  # Controle de acesso
  accessControl  {
    allow                 ALL
    deny                  
  }
}

# Cache settings
cache  {
  enableCache             1
  cacheExpire             300
  enablePrivateCache      1
  privateExpire           60
}

# Configurações PHP específicas
phpIniOverride  {
  php_admin_value engine Off
  php_admin_flag safe_mode Off
  php_admin_value disable_functions ""
  php_value max_execution_time 300
  php_value max_input_vars 3000
  php_value memory_limit 256M
  php_value upload_max_filesize 64M
  php_value post_max_size 64M
} 